@model QuailtyForm.ViewModels.ComplexFormViewModel

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Select2 CSS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
            justify-content: center; /* Center content horizontally */
            align-items: center; /* Center content vertically */
            min-height: 100vh; /* Full viewport height */
        }

        form {
            background-image: url('https://fabitech.com.tr/assets/media/logos/constructor-form.png'); /* Arka plan resmi */
            background-color: rgba(255, 255, 255, 0.3); /* Beyaz renk ve yarı şeffaf arka plan */
            background-blend-mode: color-dodge; /* Arka plan resmi ve rengi arasında karışım modu */
            background-size: cover; /* Arka plan resmini kaplayacak şekilde ayarla */
            background-position: center; /* Arka plan resmini merkeze al */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            /*          margin: auto; /* Sayfanın ortasına yerleştirir */ */ width: fit-content; /* İçeriğin genişliğine göre ayarlar */
            justify-content: center; /* Yatay eksende ortalar */
        }

            form > div {
                flex: 1;
                min-width: 100%; /* min-width ekleyerek yan yana sığabilecek minimum genişliği belirleyin */
                flex-direction: column;
                align-items: center;
            }

        h1 {
            color: #333333;
            margin-bottom: 0.5em;
            text-align: center; /* Add this line to center the text */
        }

        h3 {
            color: #333333;
            margin-bottom: 0.5em;
            align-items: center;
        }

        select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
            border: 1px solid #cccccc;
            background-color: rgba(255, 255, 255, 0.7);
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

            button:hover {
                background-color: #45a049;
            }

        .radio-options {
            display: block; /* Changed from flex to block to stack the buttons vertically */
            margin-top: 10px; /* Adjust as needed to move the buttons down */
        }

        /* Style for the labels next to radio buttons */
        .radio-label {
            font-weight: 300; /* Make font thinner */
            margin-left: 5px; /* Add a little space between the radio button and the label */
        }

        /* New styles for question list */
        .question-list {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            display: flex;
            flex-direction: column;
        }

            .question-list ul {
                list-style-type: none;
                padding: 0;
            }

            .question-list li {
                margin-bottom: 10px;
                font-weight: bold;
            }

        h1, h3 {
            font-weight: bold;
            color: black;
        }
    </style>
</head>

<body>
    <form method="post">
        <h1>Kalite Kontrol Anketi</h1>
        <div class="col-12">
            <div class="col-12">
                <div>
                    <h3>Kalite Kontrol</h3>
                    <select id="company1Select" asp-items="@(new SelectList(Model.Companies, "ProjectBlockDefId", "ControlName","SurveyId"))">
                        <option value="">Kalite Kontrol seçin...</option>
                    </select>
                </div>
                <div>
                    <h3>Blok - Kat</h3>
                    <select id="project1Select" asp-items="@(new SelectList(Model.Projects, "Id","DisplayText"))">
                        <option value="">Önce Kalite Kontrol Seçin...</option>
                    </select>
                </div>
                <div>
                    <h3>Kategori-1</h3>
                    <select id="category1Select" asp-items="@(new SelectList(Model.Categories1, "Id", "Description"))">
                        <option value="">Kategori 1 seçin...</option>
                    </select>
                </div>

                <div>
                    <h3>Kategori-2</h3>
                    <select id="category2Select">
                        <option value="">Önce Kategori 1 seçin...</option>
                    </select>
                </div>

                <div>
                    <h3>İmalat Grubu</h3>
                    <select id="category3Select">
                        <option value="">Önce Kategori 2 seçin...</option>
                    </select>
                </div>

                <div>
                    <h3>İmalat Adı</h3>
                    <select id="categorySelect" asp-items="@(new SelectList(Model.Categories4, "Id", "Description"))">
                        <option value="">Kategori4 seçin...</option>
                    </select>
                </div>
                <div style="flex-basis: 100%;">
                    <button id="listeleButton" type="button" class="bg-primary">Soruları Listele</button>
                </div>

                <!-- Question list section, initially hidden -->
                <div class="question-list" id="questionList" style="display:none;">
                    <h3>Sorular Listesi</h3>
                    <ul id="questionItems" class="question-list">
                        <!-- Sorular burada listelenecek -->
                    </ul>
                    <button type="button" onclick="submitForm()" class="save-button">Anketi Kaydet</button>
                </div>
            </div>
        </div>

    </form>
</body>



<script>
    $(document).ready(function () {
        $('#listeleButton').click(function () {
            var category1Id = $('#category1Select').val();
            var category2Id = $('#category2Select').val();
            var category3Id = $('#category3Select').val();

            $.ajax({
                url: '@Url.Action("GetQuestionData", "Form")',
                type: 'GET',
                data: {
                    category1Id: category1Id,
                    category2Id: category2Id,
                    category3Id: category3Id
                },
                success: function (questions) {
                    console.log(questions); // Gelen veriyi konsolda inceleyin

                    var list = $('#questionList ul');
                    list.empty(); // Mevcut listeyi temizle

                    $.each(questions, function (index, question) {
                        var li = $('<li>');
                        li.append(document.createTextNode(question.question_Text));
                        li.append($('<br>'));
                        // Radyo butonları ekle
                        var radioAccept = $('<input>', { type: 'radio', name: 'question' + question.id, value: 'accept' });
                        var radioReject = $('<input>', { type: 'radio', name: 'question' + question.id, value: 'reject', css: { marginLeft: '10px' } });


                        li.append(radioAccept);

                        li.append($('<label>').text('Kabul').css('color', 'green'));

                        li.append(radioReject);
                        li.append($('<label>').text('Red').css('color', 'red'));

                        list.append(li);
                    });

                    $('#questionList').show(); // Soru listesini göster
                },
                error: function (xhr, status, error) {
                    console.error("Hata:", error);
                }
            });
        });
    });
</script>

<script>
    $(document).ready(function () {
        // Category1 değişikliğinde Category2'yi güncelle
        $('#category1Select').change(function () {
            var selectedCategoryId = $(this).val();

            $.ajax({
                url: '@Url.Action("GetCategory2Data", "Form")',
                type: 'GET',
                data: { parentId: selectedCategoryId },
                success: function (data) {
                    var category2Select = $('#category2Select');
                    category2Select.empty();
                    category2Select.append($('<option>', { value: '', text: 'Kategori 2 seçin...' }));

                    $.each(data, function (index, item) {
                        category2Select.append($('<option>', {
                            value: item.id,
                            text: item.description
                        }));
                    });
                }
            });
        });

        // Category2 değişikliğinde Category3'ü güncelle
        $('#category2Select').change(function () {
            var selectedCategoryId = $(this).val();

            $.ajax({
                url: '@Url.Action("GetCategory3Data", "Form")',
                type: 'GET',
                data: { parentId: selectedCategoryId },
                success: function (data) {
                    var category3Select = $('#category3Select');
                    category3Select.empty();
                    category3Select.append($('<option>', { value: '', text: 'Kategori 3 seçin...' }));

                    $.each(data, function (index, item) {
                        category3Select.append($('<option>', {
                            value: item.id,
                            text: item.description
                        }));
                    });
                }
            });
        });

        // Kalite Kontrol Forma göre Kat Blok Seçme
        $('#company1Select').change(function () {
            var selectedProjectId = $(this).val();

            $.ajax({
                url: '@Url.Action("GetProjectData", "Form")',
                type: 'GET',
                data: { projectBlockDef: selectedProjectId },
                success: function (data) {
                    var project1Select = $('#project1Select');
                    project1Select.empty();
                    project1Select.append($('<option>', { value: '', text: 'Kalite Kontrol seçin...' }));

                    $.each(data, function (index, item) {
                        project1Select.append($('<option>', {
                            value: item.id,
                            text: item.displayText
                        }));
                    });
                }
            });
        });

    });



</script>
<script>
    function submitForm() {
        // Gather form data
        var formData = {
            surveyId: $('#company1Select').change(function () {
                var selectedOption = $(this).find('option:selected');
                var surveyId = selectedOption.attr('SurveyId');

                var formData = {
                    company1Select: $(this).val(),
                    surveyId: surveyId
                },
            projectSelect: $('#projectSelect').val(),
            category1Select: $('#category1Select').val(),
         
        
        };

        $.ajax({
            url: '@Url.Action("GetProjectData", "Form")',
            type: 'GET',
            data: { projectBlockDef: selectedProjectId },
            success: function (data) {
                var project1Select = $('#project1Select');
                project1Select.empty();
                project1Select.append($('<option>', { value: '', text: 'Kalite Kontrol Form seçin...' }));

                formData.questions.push({
                    question: question,
                    answer: answer
                });
            });
        console.log(JSON.stringify(formData));
        // AJAX POST request
        $.ajax({
            url: '@Url.Action("SubmitSurvey", "Form")',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function (response) {
                // Success logic here
                alert('Anket başarıyla kaydedildi.');
            },
            error: function (error) {
                // Error handling here
                alert('Bir hata oluştu. Anket kaydedilemedi.');
            }
        });
    }


</script>




